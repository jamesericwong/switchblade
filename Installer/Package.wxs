<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs" xmlns:ui="http://wixtoolset.org/schemas/v4/wxs/ui">
  <Package Name="SwitchBlade" Manufacturer="James Wong" Version="1.0.1.0" UpgradeCode="a3543202-6014-486c-a964-15967d6f8c44" Scope="perMachine">
    <MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." AllowSameVersionUpgrades="yes" />
    
    <MediaTemplate EmbedCab="yes" />

    <!-- Use ProgramFiles64Folder for x64 -->
    <StandardDirectory Id="ProgramFiles64Folder">
      <Directory Id="INSTALLFOLDER" Name="SwitchBlade" />
    </StandardDirectory>

    <StandardDirectory Id="ProgramMenuFolder">
        <Directory Id="ApplicationProgramsFolder" Name="SwitchBlade" />
    </StandardDirectory>

    <Feature Id="Main">
      <ComponentGroupRef Id="AppComponents" />
      <ComponentRef Id="ApplicationShortcut" />
    </Feature>
    
    <!-- UI Configuration -->
    <ui:WixUI Id="WixUI_InstallDir" InstallDirectory="INSTALLFOLDER" />
    <WixVariable Id="WixUILicenseRtf" Value="License.rtf" />
    
    <!-- Launch on Exit Logic -->
    <Property Id="WIXUI_EXITDIALOGOPTIONALCHECKBOXTEXT" Value="Launch SwitchBlade" />
    <Property Id="WIXUI_EXITDIALOGOPTIONALCHECKBOX" Value="1" />
    
    <!-- Use standard MSI action to launch installed file -->
    <CustomAction Id="LaunchApplication" FileRef="SwitchBladeEXE" ExeCommand="" Return="asyncNoWait" Impersonate="yes" />

    <UI>
        <Publish Dialog="ExitDialog" Control="Finish" Event="DoAction" Value="LaunchApplication" Condition="WIXUI_EXITDIALOGOPTIONALCHECKBOX = 1 and NOT Installed" />
    </UI>

    <!-- Content for Add/Remove Programs -->
    <Icon Id="AppIcon" SourceFile="..\icon.ico"/>
    <Property Id="ARPPRODUCTICON" Value="AppIcon" />

  </Package>

  <Fragment>
      <ComponentGroup Id="AppComponents" Directory="INSTALLFOLDER">
          <Component Bitness="always64">
              <File Id="SwitchBladeEXE" Source="..\bin\Release\net9.0-windows\win-x64\publish\SwitchBlade.exe" />
          </Component>
      </ComponentGroup>
  </Fragment>

  <Fragment>
    <DirectoryRef Id="ApplicationProgramsFolder">
      <Component Id="ApplicationShortcut" Guid="*" Bitness="always64">
        <Shortcut Id="ApplicationStartMenuShortcut" 
                  Name="SwitchBlade" 
                  Description="SwitchBlade Window Switcher"
                  Target="[INSTALLFOLDER]SwitchBlade.exe"
                  WorkingDirectory="INSTALLFOLDER" />
        <RemoveFolder Id="CleanUpShortCut" Directory="ApplicationProgramsFolder" On="uninstall" />
        <RegistryValue Root="HKCU" Key="Software\JamesWong\SwitchBlade" Name="installed" Type="integer" Value="1" KeyPath="yes" />
      </Component>
    </DirectoryRef>
  </Fragment>
</Wix>
