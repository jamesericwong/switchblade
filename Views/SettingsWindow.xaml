<Window
    x:Class="SwitchBlade.Views.SettingsWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:SwitchBlade.Views"
    xmlns:core="using:SwitchBlade.Core"
    Title="SwitchBlade Settings">
    
    <Window.SystemBackdrop>
        <MicaBackdrop />
    </Window.SystemBackdrop>

    <Grid Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- Title Bar -->
            <RowDefinition Height="*"/>    <!-- Content -->
        </Grid.RowDefinitions>

        <!-- Custom Title Bar -->
        <Grid Grid.Row="0" Background="Transparent" Height="48">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <TextBlock Text="SwitchBlade Settings" 
                       VerticalAlignment="Center" 
                       Margin="16,0,0,0" 
                       FontSize="14" 
                       FontWeight="SemiBold"/>
            
            <Button Grid.Column="1" 
                    Content="&#xE711;" 
                    FontFamily="{ThemeResource SymbolThemeFontFamily}"
                    Width="48" Height="48"
                    Background="Transparent"
                    Click="CloseButton_Click"/>
        </Grid>

        <!-- Main Content -->
        <ScrollViewer Grid.Row="1" Margin="20">
            <StackPanel Spacing="16">
                <!-- Appearance Section -->
                <Expander Header="Appearance" IsExpanded="True" HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch">
                    <StackPanel Spacing="12" Padding="12">
                        <ComboBox Header="Theme" 
                                  ItemsSource="{x:Bind ViewModel.AvailableThemes, Mode=OneWay}" 
                                  SelectedItem="{x:Bind ViewModel.SelectedTheme, Mode=TwoWay}" 
                                  HorizontalAlignment="Stretch"/>
                        
                        <Slider Header="Window Opacity" 
                                Minimum="0.2" Maximum="1.0" 
                                Value="{x:Bind ViewModel.WindowOpacity, Mode=TwoWay}" 
                                StepFrequency="0.05"/>
                        
                        <Slider Header="Fade Duration (ms)" 
                                Minimum="0" Maximum="1000" 
                                Value="{x:Bind ViewModel.FadeDurationMs, Mode=TwoWay}" 
                                StepFrequency="50"/>
                        
                        <Slider Header="Item Height" 
                                Minimum="30" Maximum="100" 
                                Value="{x:Bind ViewModel.ItemHeight, Mode=TwoWay}" 
                                StepFrequency="5"/>
                        
                        <TextBox Header="Global Hotkey" 
                                 x:Name="HotKeyBox" 
                                 Text="{x:Bind ViewModel.HotKeyString, Mode=OneWay}" 
                                 IsReadOnly="True" 
                                 PlaceholderText="Click and press keys"
                                 PreviewKeyDown="HotKeyBox_PreviewKeyDown"/>
                        
                        <ToggleSwitch Header="Enable Window Previews" 
                                      IsOn="{x:Bind ViewModel.EnablePreviews, Mode=TwoWay}"/>
                        
                        <ToggleSwitch Header="Hide Taskbar Icon" 
                                      IsOn="{x:Bind ViewModel.HideTaskbarIcon, Mode=TwoWay}"/>
                        
                        <ToggleSwitch Header="Launch on Windows Startup" 
                                      IsOn="{x:Bind ViewModel.LaunchOnStartup, Mode=TwoWay}"/>
                        
                        <ToggleSwitch Header="Run as Administrator" 
                                      IsOn="{x:Bind ViewModel.RunAsAdministrator, Mode=TwoWay}"/>
                        
                        <ToggleSwitch Header="Enable Number Shortcuts (1-9, 0)" 
                                      IsOn="{x:Bind ViewModel.EnableNumberShortcuts, Mode=TwoWay}"/>
                        
                        <ComboBox Header="Shortcut Modifier" 
                                  ItemsSource="{x:Bind ViewModel.AvailableShortcutModifiers, Mode=OneWay}" 
                                  SelectedItem="{x:Bind ViewModel.SelectedShortcutModifier, Mode=TwoWay}" 
                                  HorizontalAlignment="Stretch"/>
                    </StackPanel>
                </Expander>
                
                <!-- Background Polling Section -->
                <Expander Header="Background Polling" HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch">
                    <StackPanel Spacing="12" Padding="12">
                        <ToggleSwitch Header="Enable Background Polling" 
                                      IsOn="{x:Bind ViewModel.EnableBackgroundPolling, Mode=TwoWay}"/>
                        
                        <Slider Header="Interval (seconds)" 
                                Minimum="5" Maximum="120" 
                                Value="{x:Bind ViewModel.BackgroundPollingIntervalSeconds, Mode=TwoWay}" 
                                StepFrequency="5"/>
                        
                        <RadioButtons Header="List Refresh Behavior">
                            <RadioButton Content="Preserve scroll position" 
                                         IsChecked="{x:Bind ViewModel.IsPreserveScrollSelected, Mode=TwoWay}"/>
                            <RadioButton Content="Follow selected window" 
                                         IsChecked="{x:Bind ViewModel.IsPreserveIdentitySelected, Mode=TwoWay}"/>
                            <RadioButton Content="Keep selection index" 
                                         IsChecked="{x:Bind ViewModel.IsPreserveIndexSelected, Mode=TwoWay}"/>
                        </RadioButtons>
                    </StackPanel>
                </Expander>
                
                <!-- Excluded Processes Section -->
                <Expander Header="Excluded Processes" HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch">
                    <StackPanel Spacing="12" Padding="12">
                        <TextBlock Text="Process names to hide from results (e.g., SwitchBlade)" 
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}" 
                                   TextWrapping="Wrap"/>

                        <ListView ItemsSource="{x:Bind ViewModel.ExcludedProcesses, Mode=OneWay}" 
                                  SelectedItem="{x:Bind ViewModel.SelectedExcludedProcess, Mode=TwoWay}"
                                  Height="150"/>

                        <Grid ColumnSpacing="8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBox Text="{x:Bind ViewModel.NewExcludedProcessName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                            <Button Grid.Column="1" Content="Add" Command="{x:Bind ViewModel.AddExcludedProcessCommand}"/>
                            <Button Grid.Column="2" Content="Remove" Command="{x:Bind ViewModel.RemoveExcludedProcessCommand}"/>
                        </Grid>
                    </StackPanel>
                </Expander>
                
                <!-- Loaded Plugins Section -->
                <Expander Header="Loaded Plugins" HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch">
                    <StackPanel Spacing="12" Padding="12">
                        <TextBlock Text="Active IWindowProvider modules" 
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        
                        <ListView x:Name="PluginsListView" 
                                  ItemsSource="{x:Bind ViewModel.LoadedPlugins, Mode=OneWay}" 
                                  Height="200">
                            <ListView.ItemTemplate>
                                <DataTemplate>
                                    <Grid Padding="8" ColumnSpacing="12">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="100"/>
                                            <ColumnDefinition Width="60"/>
                                            <ColumnDefinition Width="60"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text="{Binding Name}" VerticalAlignment="Center"/>
                                        <TextBlock Grid.Column="1" Text="{Binding Version}" 
                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}" VerticalAlignment="Center"/>
                                        <CheckBox Grid.Column="2" IsChecked="{Binding IsEnabled, Mode=TwoWay}" 
                                                  IsEnabled="{Binding IsInternal, Converter={StaticResource InverseBoolConverter}}"/>
                                        <Button Grid.Column="3" 
                                                Content="&#xE713;" 
                                                FontFamily="{ThemeResource SymbolThemeFontFamily}"
                                                Click="PluginSettingsButton_Click"
                                                Tag="{Binding}"
                                                Visibility="{Binding HasSettings}"/>
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                    </StackPanel>
                </Expander>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Window>
