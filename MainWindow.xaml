<Window
    x:Class="SwitchBlade.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:SwitchBlade"
    xmlns:core="using:SwitchBlade.Core"
    xmlns:contracts="using:SwitchBlade.Contracts"
    Title="SwitchBlade">
    
    <Window.SystemBackdrop>
        <MicaBackdrop />
    </Window.SystemBackdrop>
    
    <!-- Main Border with Dynamic Theme -->
    <Border Margin="0" 
            Background="{ThemeResource WindowBackground}"
            CornerRadius="8">
        
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            
            <!-- Custom Title Bar / Drag Bar -->
            <Border x:Name="DragBar"
                    Grid.Row="0"
                    Background="Transparent"
                    Height="32">
                <StackPanel Orientation="Horizontal" 
                            HorizontalAlignment="Center" 
                            VerticalAlignment="Center"
                            Opacity="0.4">
                    <!-- Grip dots indicator -->
                    <TextBlock Text="⋮" FontSize="12" Foreground="{ThemeResource TextFillColorPrimaryBrush}" Margin="1,0"/>
                    <TextBlock Text="⋮" FontSize="12" Foreground="{ThemeResource TextFillColorPrimaryBrush}" Margin="1,0"/>
                    <TextBlock Text="⋮" FontSize="12" Foreground="{ThemeResource TextFillColorPrimaryBrush}" Margin="1,0"/>
                </StackPanel>
            </Border>
            
            <!-- Main Content Grid -->
            <Grid Grid.Row="1" Margin="20,0,20,20">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" /> <!-- Preview Column -->
                </Grid.ColumnDefinitions>

                <!-- Left Pane (Search + Results) -->
                <Grid Grid.Column="0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/> <!-- Search Bar -->
                        <RowDefinition Height="*"/>    <!-- Results -->
                    </Grid.RowDefinitions>

                    <!-- Search Bar -->
                    <Border Grid.Row="0" 
                            Background="{ThemeResource ControlFillColorDefaultBrush}" 
                            CornerRadius="8" 
                            Padding="10,5">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <Image Source="/Resources/search_icon.png"
                                   Width="18" Height="18"
                                   VerticalAlignment="Center"
                                   Margin="0,0,10,0"/>
                            
                            <TextBox x:Name="SearchBox"
                                     Grid.Column="1"
                                     PlaceholderText="Search windows..."
                                     BorderThickness="0"
                                     Background="Transparent"
                                     FontSize="18"
                                     VerticalAlignment="Center"
                                     Text="{x:Bind ViewModel.SearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                        </Grid>
                    </Border>

                    <!-- Results List -->
                    <ListView x:Name="ResultsConfig"
                              Grid.Row="1"
                              Margin="0,20,0,0"
                              Background="Transparent"
                              BorderThickness="0"
                              ItemsSource="{x:Bind ViewModel.FilteredWindows, Mode=OneWay}"
                              SelectedItem="{x:Bind ViewModel.SelectedWindow, Mode=TwoWay}"
                              SelectionMode="Single">
                        <ListView.ItemTemplate>
                            <DataTemplate x:DataType="contracts:WindowItem">
                                <Grid Padding="10" Margin="0,2" CornerRadius="6">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <!-- Number Badge for shortcuts -->
                                    <Border x:Name="NumberBadge"
                                            Grid.Column="0"
                                            Background="{ThemeResource ControlFillColorSecondaryBrush}"
                                            CornerRadius="4"
                                            Padding="6,4"
                                            Margin="0,0,10,0"
                                            VerticalAlignment="Center"
                                            Visibility="{x:Bind IsShortcutVisible, Mode=OneWay}">
                                        <TextBlock Text="{x:Bind ShortcutDisplay, Mode=OneWay}"
                                                   FontSize="11"
                                                   FontWeight="Bold"
                                                   Foreground="{ThemeResource TextFillColorPrimaryBrush}"
                                                   VerticalAlignment="Center"/>
                                    </Border>
                                    
                                    <StackPanel Grid.Column="1">
                                        <TextBlock Text="{x:Bind Title}" 
                                                   Foreground="{ThemeResource TextFillColorPrimaryBrush}" 
                                                   FontSize="14" 
                                                   TextTrimming="CharacterEllipsis"/>
                                        <TextBlock Text="{x:Bind ProcessName}" 
                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}" 
                                                   FontSize="12" 
                                                   Opacity="0.7"/>
                                    </StackPanel>
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </Grid>

                <!-- Preview Panel -->
                <Border x:Name="PreviewPanel"
                        Grid.Column="1"
                        Width="400"
                        Margin="20,0,0,0"
                        Background="{ThemeResource LayerOnMicaBaseAltFillColorDefaultBrush}"
                        Opacity="0.9"
                        CornerRadius="8"
                        BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                        BorderThickness="1"
                        Visibility="{x:Bind ViewModel.EnablePreviews, Mode=OneWay}">
                    
                    <!-- This Canvas is the target for DWM Thumbnail -->
                    <Canvas x:Name="PreviewCanvas" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" />
                </Border>
            </Grid>
        </Grid>
    </Border>
</Window>
